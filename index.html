<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StevenTools — Online Tools</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg: linear-gradient(135deg,#eef2f3 0%,#d9e2ec 100%);
  --menu-bg:#fff; --card:#fff; --text:#1f2937; --muted:rgba(0,0,0,0.45);
  --accent:#3b82f6; --glass:rgba(255,255,255,0.6); --shadow:0 10px 30px rgba(2,6,23,0.06);
}
[data-theme="dark"]{
  --bg: linear-gradient(135deg,#071023 0%,#0b1220 100%);
  --menu-bg:rgba(12,14,18,0.85); --card:rgba(8,10,14,0.72);
  --text:#e6eef6; --muted:rgba(255,255,255,0.55); --glass:rgba(255,255,255,0.03);
  --accent:#60a5fa; --shadow:0 12px 40px rgba(0,0,0,0.6);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
.app{display:flex;min-height:100vh;}
.sidebar{width:260px;background:var(--menu-bg);padding:20px;border-right:1px solid rgba(0,0,0,0.06);position:sticky;top:0;height:100vh;overflow:auto;}
.brand{display:flex;gap:12px;align-items:center;margin-bottom:14px}
.logo{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),#7c3aed);color:#fff;font-weight:700;font-size:18px;box-shadow:0 6px 18px rgba(59,130,246,0.18);}
.brand-title{font-weight:700;font-size:18px;}
.brand-sub{font-size:12px;color:var(--muted);}
.controls{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap;}
.btn{padding:8px 12px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer;}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(59,130,246,0.18);}
.select{padding:8px 10px;border-radius:10px;border:1px solid #d1d5db;background:transparent;color:var(--text);}
.menu-section{margin-top:10px;}
.menu-header{font-weight:700;cursor:pointer;padding:8px 4px;border-radius:8px;}
.menu-items{padding-left:8px;margin-top:6px;display:none;}
.menu-item{padding:8px;border-radius:8px;cursor:pointer;color:var(--text);}
.menu-item:hover{color:var(--accent);}
.menu-item.active{color:var(--accent);font-weight:700;background:linear-gradient(90deg,rgba(59,130,246,0.06),transparent);}
.main{flex:1;padding:28px;display:flex;flex-wrap:wrap;gap:20px;align-content:flex-start;justify-content:flex-start;}
.card{width:min(540px,calc(50%-20px));background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,0.04);transition: transform 360ms cubic-bezier(.2,.9,.2,1), box-shadow 360ms, opacity 300ms, filter 300ms;transform-origin:center center;will-change:transform,opacity;}
.card h3{margin:0 0 8px 0;}
.muted{color:var(--muted);font-size:13px;}
.label{display:block;margin-top:10px;font-size:13px;color:var(--muted);}
.controls-row{margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.output{margin-top:12px;padding:10px;border-radius:10px;background:var(--glass);border:1px solid rgba(0,0,0,0.04);min-height:42px;white-space:pre-wrap;word-break:break-word;}
.card.focused{transform:scale(1.06);box-shadow:0 30px 80px rgba(2,6,23,0.45);z-index:30;filter:none;}
.card.dimmed{opacity:0.35;filter: blur(0.3px) saturate(0.9);pointer-events:none;}
@media (max-width:900px){.sidebar{display:none}.card{width:100%}.main{padding:16px}.app{flex-direction:column}}
.small{font-size:13px;color:var(--muted);}
</style>
</head>
<body>
<div class="app" id="appRoot" data-theme="light">
<aside class="sidebar">
<div class="brand">
<div class="logo">ST</div>
<div>
<div id="brandTitle" class="brand-title">StevenTools</div>
<div id="brandSub" class="brand-sub">Lightweight browser tools</div>
</div>
</div>
<div class="controls">
<button id="themeBtn" class="btn ghost" title="Toggle theme">Theme</button>
<select id="langSelect" class="select">
<option value="en">English</option>
<option value="zh">中文</option>
</select>
<button id="downloadBtn" class="btn ghost">Download</button>
</div>
<nav class="menu">
<div class="menu-section">
<div id="menuBasic" class="menu-header" onclick="toggleMenu('basic')">Basic Tools</div>
<div id="basic" class="menu-items" style="display:block">
<div class="menu-item" data-target="card-uuid" onclick="menuGoto(event)">UUID Generator</div>
<div class="menu-item" data-target="card-pw" onclick="menuGoto(event)">Password Generator</div>
<div class="menu-item" data-target="card-text" onclick="menuGoto(event)">JSON / Text Tools</div>
</div>
</div>
<div class="menu-section">
<div id="menuEncode" class="menu-header" onclick="toggleMenu('encode')">Encoding & Encryption</div>
<div id="encode" class="menu-items">
<div class="menu-item" data-target="card-aes" onclick="menuGoto(event)">AES-GCM</div>
<div class="menu-item" data-target="card-b64" onclick="menuGoto(event)">Base64</div>
</div>
</div>
<div class="menu-section">
<div id="menuNet" class="menu-header" onclick="toggleMenu('network')">Network</div>
<div id="network" class="menu-items">
<div class="menu-item" data-target="card-speed" onclick="menuGoto(event)">Web Speed Test</div>
</div>
</div>
</nav>
</aside>

<main class="main" id="mainArea">
<section class="card" id="card-uuid">
<h3 data-t="uuid_title">UUID Generator</h3>
<div class="muted" data-t="uuid_desc">Generate RFC4122 v4 UUID</div>
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-uuid'); genUUID()" data-t="btn_generate">Generate</button>
<button class="btn ghost" onclick="copyText('uuidOut')" data-t="btn_copy">Copy</button>
</div>
<div id="uuidOut" class="output small">Waiting</div>
</section>

<section class="card" id="card-pw">
<h3 data-t="pw_title">Password Generator</h3>
<div class="muted" data-t="pw_desc">Choose length & charset</div>
<label class="label" data-t="pw_length">Length</label>
<input id="pwLen" type="number" min="4" max="128" value="16" />
<label class="label" data-t="pw_charset">Charset</label>
<select id="pwPreset">
<option value="strong">Strong (letters+digits+symbols)</option>
<option value="alnum">Letters + digits</option>
<option value="letters">Letters only</option>
<option value="custom">Custom</option>
</select>
<input id="pwCustom" placeholder="Custom charset" style="display:none;margin-top:8px" />
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-pw'); genPassword()" data-t="btn_generate">Generate</button>
<button class="btn ghost" onclick="copyText('pwOut')" data-t="btn_copy">Copy</button>
</div>
<div id="pwOut" class="output small">Waiting</div>
</section>

<section class="card" id="card-aes">
<h3>AES-GCM (local)</h3>
<div class="muted">Encrypt/decrypt locally (Base64 output)</div>
<label class="label">Key</label>
<input id="aesKey" placeholder="passphrase">
<label class="label">Plaintext / Ciphertext</label>
<textarea id="aesInput" placeholder="plaintext or iv:base64cipher"></textarea>
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-aes'); aesEncrypt()">Encrypt</button>
<button class="btn ghost" onclick="aesDecrypt()">Decrypt</button>
<button class="btn ghost" onclick="clearAes()">Clear</button>
</div>
<div id="aesOut" class="output small"></div>
</section>

<section class="card" id="card-b64">
<h3>Base64</h3>
<div class="muted">UTF-8 safe Base64 encode/decode</div>
<textarea id="b64Input" placeholder="text or base64"></textarea>
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-b64'); b64Encode()">Encode</button>
<button class="btn ghost" onclick="b64Decode()">Decode</button>
<button class="btn ghost" onclick="copyText('b64Out')">Copy</button>
</div>
<div id="b64Out" class="output small"></div>
</section>

<section class="card" id="card-text">
<h3 data-t="json_title">JSON / Text Tools</h3>
<textarea id="textInput" placeholder='Paste JSON or text here'></textarea>
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-text'); prettyJSON()" data-t="btn_pretty">Pretty JSON</button>
<button class="btn ghost" onclick="minifyJSON()" data-t="btn_minify">Minify JSON</button>
<button class="btn ghost" onclick="trimLines()">Trim line starts</button>
<button class="btn ghost" onclick="copyText('textOut')">Copy</button>
</div>
<div id="textOut" class="output small"></div>
</section>

<section class="card" id="card-speed">
<h3 data-t="speed_title">Web Speed Test</h3>
<div class="muted">Lightweight fetch timing</div>
<input id="speedUrl" placeholder="https://example.com" />
<div class="controls-row">
<button class="btn" onclick="handleFocus('card-speed'); runSpeedTest()" data-t="btn_test">Test</button>
<button class="btn ghost" onclick="clearSpeed()">Clear</button>
</div>
<div id="speedOut" class="output small"></div>
</section>
</main>
</div>

<script>
// Theme
const root = document.getElementById('appRoot');
function applyTheme(t){root.setAttribute('data-theme',t); localStorage.setItem('st_theme',t);}
const savedTheme = localStorage.getItem('st_theme');
if(savedTheme) applyTheme(savedTheme);
else applyTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
document.getElementById('themeBtn').addEventListener('click',()=>{applyTheme(root.getAttribute('data-theme')==='dark'?'light':'dark');});

// Language
const LANG = {
  en:{brand:'StevenTools', sub:'Lightweight browser tools', menu_basic:'Basic Tools', menu_encode:'Encoding & Encryption', menu_network:'Network', uuid_title:'UUID Generator', uuid_desc:'Generate RFC4122 v4 UUID', pw_title:'Password Generator', pw_desc:'Choose length & charset', pw_length:'Length', pw_charset:'Charset', btn_generate:'Generate', btn_copy:'Copy', btn_pretty:'Pretty JSON', btn_minify:'Minify JSON', json_title:'JSON / Text Tools', speed_title:'Web Speed Test'},
  zh:{brand:'StevenTools', sub:'轻量实用的浏览器工具', menu_basic:'基础工具', menu_encode:'编码与加密', menu_network:'网络工具', uuid_title:'UUID 生成器', uuid_desc:'生成 RFC4122 v4 UUID', pw_title:'密码生成器', pw_desc:'选择长度与字符集', pw_length:'长度', pw_charset:'字符集', btn_generate:'生成', btn_copy:'复制', btn_pretty:'JSON 美化', btn_minify:'JSON 压缩', json_title:'JSON / 文本工具', speed_title:'网页测速'}
};
const langSelect = document.getElementById('langSelect');
const sysLang = (navigator.language||'en').startsWith('zh')?'zh':'en';
const savedLang = localStorage.getItem('st_lang')||sysLang;
langSelect.value = savedLang;
applyLang(savedLang);
langSelect.addEventListener('change',()=>applyLang(langSelect.value));
function applyLang(l){
  localStorage.setItem('st_lang',l);
  const pack = LANG[l]||LANG.en;
  document.getElementById('brandTitle').innerText = pack.brand;
  document.getElementById('brandSub').innerText = pack.sub;
  document.getElementById('menuBasic').innerText = pack.menu_basic;
  document.getElementById('menuEncode').innerText = pack.menu_encode;
  document.getElementById('menuNet').innerText = pack.menu_network;
  document.querySelectorAll('[data-t]').forEach(el=>{const k=el.getAttribute('data-t');if(pack[k]) el.innerText=pack[k];});
}

// Download
document.getElementById('downloadBtn').addEventListener('click',()=>{
  const html = '<!doctype html>\\n'+document.documentElement.outerHTML;
  const blob = new Blob([html],{type:'text/html'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='steventools.html'; a.click();
  URL.revokeObjectURL(a.href);
});

// Menu
function toggleMenu(id){const el=document.getElementById(id);el.style.display=el.style.display==='block'?'none':'block';}
function menuGoto(evt){const t=evt.currentTarget.getAttribute('data-target');document.querySelectorAll('.menu-item').forEach(mi=>mi.classList.remove('active'));evt.currentTarget.classList.add('active');const el=document.getElementById(t);if(el){handleFocus(t);el.scrollIntoView({behavior:'smooth',block:'center'});}}

// Focus
let currentFocused=null;
function handleFocus(cardId){
  const card=document.getElementById(cardId);if(!card) return;
  const all=Array.from(document.querySelectorAll('.card'));
  if(currentFocused===cardId){card.classList.remove('focused');all.forEach(c=>c.classList.remove('dimmed'));currentFocused=null;return;}
  currentFocused=cardId;
  all.forEach(c=>{if(c.id===cardId){c.classList.add('focused');c.classList.remove('dimmed');c.style.zIndex=30;}else{c.classList.remove('focused');c.classList.add('dimmed');c.style.zIndex='';}});
  setTimeout(()=>{card.scrollIntoView({behavior:'smooth',block:'center'});},160);
}

// Utils
function copyText(id){const el=document.getElementById(id);if(!el)return alert('Nothing to copy');const txt=el.innerText||el.value||'';if(!txt)return alert('Empty');navigator.clipboard.writeText(txt).then(()=>alert('Copied!')).catch(()=>alert('Copy failed'));}

// Tools: UUID
function genUUID(){try{document.getElementById('uuidOut').innerText=crypto.randomUUID();}catch(e){document.getElementById('uuidOut').innerText='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);});}}

// Password
const pwPreset=document.getElementById('pwPreset');pwPreset.addEventListener('change',()=>{document.getElementById('pwCustom').style.display=pwPreset.value==='custom'?'block':'none';});
function genPassword(){const len=parseInt(document.getElementById('pwLen').value)||16;let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}<>?~";if(pwPreset.value==='alnum') chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";else if(pwPreset.value==='letters') chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";else if(pwPreset.value==='custom') chars=document.getElementById('pwCustom').value||'abcdefghijklmnopqrstuvwxyz';let out='';const arr=new Uint32Array(len);window.crypto.getRandomValues(arr);for(let i=0;i<len;i++) out+=chars[arr[i]%chars.length];document.getElementById('pwOut').innerText=out;}

// AES-GCM
async function deriveKey(password,salt){
